const formularioBusca=document.getElementById("formularioBusca"),formularioCadastro=document.getElementById("formularioCadastro"),formularioObservacao=document.getElementById("formularioObservacao"),formularioObservacaoEdicao=document.getElementById("formularioObservacaoEdicao"),pagina=window.location.pathname,socket=io();function AcessarOrdem(){var e=localStorage.getItem("numeroOrdem");window.location="ordem.html?numero="+e}function CadastrarOrdemBuscada(){var e=localStorage.getItem("numeroOrdem");socket.emit("cadastro",e),socket.on("sucessoCadastro",function(){AcessarOrdem()})}if(localStorage.setItem("numeroImagemPre",0),localStorage.setItem("limitePre",0),localStorage.setItem("limitePos",0),localStorage.setItem("numeroImagemPos",0),localStorage.setItem("houveExclusaoPre",0),localStorage.setItem("houveExclusaoPos",0),"/index.html"==pagina&&(formularioBusca.addEventListener("submit",function(e){e.preventDefault();e=e.target.elements.numeroBusca.value;0==String(e).length||4<String(e).length||e<=0?document.getElementById("PopUpErroBuscaIntervalo").style.display="flex":(localStorage.setItem("numeroOrdem",e),socket.emit("busca",e))}),socket.on("sucessoBusca",function(e){e?(numeroOrdem=localStorage.getItem("numeroOrdem"),AcessarOrdem()):document.getElementById("PopUpErroBusca").style.display="flex"})),"/cadastro-ordem.html"==pagina&&(formularioCadastro.addEventListener("submit",function(e){e.preventDefault();e=e.target.elements.numeroCadastro.value;0==String(e).length||e<=0||4<String(e).length?document.getElementById("PopUpErroBuscaIntervalo").style.display="flex":(localStorage.setItem("numeroOrdem",e),socket.emit("cadastro",e))}),socket.on("sucessoCadastro",function(e){e?document.getElementById("PopUpCadastro").style.display="flex":document.getElementById("PopUpErroCadastroExiste").style.display="flex"})),"/ordem.html"!==pagina&&localStorage.setItem("statusObservacao","desatualizada"),"/ordem.html"==pagina){let e=localStorage.getItem("numeroOrdem"),t=localStorage.getItem("observacao"),a=localStorage.getItem("statusObservacao");document.getElementById("conteudoObservacao").innerHTML=t,document.getElementById("TituloOrdem").innerHTML="ordem #"+e,socket.emit("conferirObservacao",e),"atualizada"==a&&null==t&&(document.getElementById("LinkOrdem").innerHTML="adicionar observação");let o=document.getElementById("enviarImagemPre");o.addEventListener("change",function(){if(this.files[0].name.match(/.(jpg|jpeg|png)$/i)){var t=localStorage.getItem("numeroImagemPre");CriarItemImagem(0);var a="imagemPre"+String(++t),t=this.files[0];if(t){const e=new FileReader;e.addEventListener("load",function(){document.getElementById(a).setAttribute("src",this.result)}),e.readAsDataURL(t)}}else document.getElementById("PopUpErroFormatoImagem").style.display="flex"});let l=document.getElementById("enviarImagemPos");l.addEventListener("change",function(){if(this.files[0].name.match(/.(jpg|jpeg|png)$/i)){var t=localStorage.getItem("numeroImagemPos");CriarItemImagem(1);var a="imagemPos"+String(++t),t=this.files[0];if(t){const e=new FileReader;e.addEventListener("load",function(){document.getElementById(a).setAttribute("src",this.result)}),e.readAsDataURL(t)}}else document.getElementById("PopUpErroFormatoImagem").style.display="flex"}),formularioObservacao.addEventListener("submit",function(e){e.preventDefault();var t=localStorage.getItem("numeroOrdem"),e=e.target.elements.inputObservacao.value;255<e.length?(document.getElementById("PopUpObservacaoVazia").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):e.length<=0?(localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",null,t)):(localStorage.setItem("statusObservacao","desatualizada"),socket.emit("alteracaoObservacao",e,t))}),formularioObservacaoEdicao.addEventListener("submit",function(e){e.preventDefault();var t=localStorage.getItem("numeroOrdem"),e=e.target.elements.inputObservacao.value;localStorage.setItem("observacao",e),255<e.length?(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):e.length<=0?(localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",null,t)):(localStorage.removeItem("observacao"),localStorage.setItem("statusObservacao","desatualizada"),socket.emit("alteracaoObservacao",e,t))}),socket.on("resultadoAlteracaoObservacao",function(e){e?location.reload():(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex")}),socket.on("sucessoCadastro",function(e){e?document.getElementById("PopUpCadastro").style.display="flex":document.getElementById("PopUpErroCadastroExiste").style.display="flex"}),socket.on("sucessoExclusao",function(e){e?paraIndex():document.getElementById("PopUpErroExclusaoOrdem").style.display="flex"}),socket.on("temObservacao",function(e){localStorage.getItem("statusObservacao");null!==e?localStorage.setItem("observacao",e):localStorage.removeItem("observacao"),"desatualizada"==localStorage.getItem("statusObservacao")&&(localStorage.setItem("statusObservacao","atualizada"),location.reload())}),socket.on("imagemVolta",function(e){var t=new Image,t="data:image/png;base64,"+e;document.getElementById("imagemPopUp").setAttribute("src",t)})}function AcessarObservacao(){null==localStorage.getItem("observacao")?document.getElementById("PopUpObservacaoVazia").style.display="flex":document.getElementById("PopUpObservacaoPreenchida").style.display="flex"}function ExibirConfirmacaoAlteracaoObservacao(){document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpConfirmacaoAlteracao").style.display="flex"}function ConfirmarEdicaoObservacao(){var e,t=evento.target.elements.inputObservacao.value;255<t.length?(document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="flex"):(e=localStorage.getItem("numeroOrdem"),localStorage.removeItem("observacao"),socket.emit("alteracaoObservacao",t,e))}function ExibirConfirmacaoExclusaoOrdem(){document.getElementById("PopUpExclusao").style.display="flex"}function ExcluirOrdem(){var e=localStorage.getItem("numeroOrdem");socket.emit("exclusao",e)}function CriarItemImagem(e){if(e){let l=localStorage.getItem("numeroImagemPos"),m=localStorage.getItem("limitePos");if(m<8){7==m&&(document.getElementById("inputImagemPosExecucao").style.display="none"),localStorage.setItem("numeroImagemPos",++l),localStorage.setItem("limitePos",++m);let e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("img"),o=document.createElement("i");e.className="system__order-details__image-grid__picture",t.className="system__order-details__image-grid__picture__remove",a.setAttribute("id","imagemPos"+String(l));var n="imagemPosQuadro"+String(l);a.addEventListener("click",function(e){AmpliarImagem("imagemPos"+String(l)),e.preventDefault()}),t.addEventListener("click",function(e){RemoverImagem(n,1,!1),e.preventDefault()}),e.setAttribute("id","imagemPosQuadro"+String(l)),o.className="fas",o.classList.add("fa-times"),t.appendChild(o),e.appendChild(t),e.appendChild(a),document.querySelector(".posExecucao").appendChild(e)}else console.log("imagemPos lotada")}else{let l=localStorage.getItem("numeroImagemPre"),m=localStorage.getItem("limitePre");if(m<8){7==m&&(document.getElementById("inputImagemPreExecucao").style.display="none"),localStorage.setItem("numeroImagemPre",++l),localStorage.setItem("limitePre",++m);let e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("img"),o=document.createElement("i");t.className="system__order-details__image-grid__picture__remove",a.setAttribute("id","imagemPre"+String(l));var r="imagemPreQuadro"+String(l);e.className="system__order-details__image-grid__picture",a.addEventListener("click",function(e){AmpliarImagem("imagemPre"+String(l)),e.preventDefault()}),t.addEventListener("click",function(e){RemoverImagem(r,0,0),e.preventDefault()}),e.setAttribute("id","imagemPreQuadro"+String(l)),o.className="fas",o.classList.add("fa-times"),t.appendChild(o),e.appendChild(t),e.appendChild(a),document.querySelector(".preExecucao").appendChild(e)}else console.log("imagemPre lotada")}}function AmpliarImagem(e){let t=document.getElementById(e).src,a=document.getElementById("imagemPopUp");a.setAttribute("src",t),document.getElementById("PopUpImagem").style.display="flex";e=t.replace(/^data:image\/[^;]+/,"data:application/octet-stream");document.getElementById("botaoBaixarImagem").setAttribute("href",e)}function RemoverImagem(e,t,a){var o,l;a?1==t?(localStorage.setItem("houveExclusaoPos",!0),document.getElementById(e).remove(),o=localStorage.getItem("limitePos"),localStorage.setItem("limitePos",--o),localStorage.setItem("primeiraVez",!0),7!=o&&!l||(ExibirBotaoAdicaoImagem(t),l=!1)):(o=localStorage.getItem("limitePre"),localStorage.setItem("limitePre",--o),localStorage.setItem("houveExclusaoPre",!0),document.getElementById(e).remove(),localStorage.setItem("primeiraVez",!0),7!=o&&!l||(ExibirBotaoAdicaoImagem(t),l=!1)):(localStorage.setItem("idImagem",e),localStorage.setItem("imagemPos",t),document.getElementById("PopUpExclusaoImagem").style.display="flex")}function ExibirBotaoAdicaoImagem(e){var t=localStorage.getItem("primeiraVez");1==e?document.getElementById("inputImagemPosExecucao").style.display="block":document.getElementById("inputImagemPreExecucao").style.display="block",t&&localStorage.removeItem("primeiraVez")}function ConfirmarRemocaoImagem(){var e=localStorage.getItem("imagemPos");RemoverImagem(localStorage.getItem("idImagem"),e,!0),fecharPopUp(),localStorage.removeItem("imagemPos"),localStorage.removeItem("idImagem")}window.addEventListener("keydown",function(e){void 0!==e.key&&("Enter"==e.key&&document.activeElement.click(),"Escape"==e.key&&fecharPopUp(),"F1"==e.key&&(e.preventDefault(),abrirPainelAjuda()))});var isPainelAjudaAberto=!1,guiaAberto="nenhum";function paraIndex(){window.location="index.html"}function paraCadastroOrdem(){window.location="cadastro-ordem.html"}function abrirPainelAjuda(){isPainelAjudaAberto=isPainelAjudaAberto?"nenhum"!==guiaAberto?("consulta"==guiaAberto?document.getElementById("AjudaConsulta").style.display="none":"cadastro"==guiaAberto?document.getElementById("AjudaCadastro").style.display="none":"alteracao"==guiaAberto?document.getElementById("AjudaAlteracao").style.display="none":"adicaoImagem"==guiaAberto?document.getElementById("AjudaAdicaoImagem").style.display="none":"remocaoImagem"==guiaAberto?document.getElementById("AjudaRemocaoImagem").style.display="none":"extra"==guiaAberto&&(document.getElementById("AjudaExtra").style.display="none"),document.querySelector(".modal-ajuda__content__items").style.display="block",guiaAberto="nenhum",!0):!(document.querySelector(".modal-ajuda").style.display="none"):(document.querySelector(".modal-ajuda").style.display="flex",document.querySelector(".modal-ajuda__content__items").style.display="block",!0)}function abrirItemAjuda(e){document.querySelector(".modal-ajuda__content__items").style.display="none","consulta"==e?(document.getElementById("AjudaConsulta").style.display="block",guiaAberto="consulta"):"cadastro"==e?(document.getElementById("AjudaCadastro").style.display="block",guiaAberto="cadastro"):"alteracao"==e?(document.getElementById("AjudaAlteracao").style.display="block",guiaAberto="alteracao"):"adicaoImagem"==e?(document.getElementById("AjudaAdicaoImagem").style.display="block",guiaAberto="adicaoImagem"):"remocaoImagem"==e?(document.getElementById("AjudaRemocaoImagem").style.display="block",guiaAberto="remocaoImagem"):"extra"==e&&(document.getElementById("AjudaExtra").style.display="block",guiaAberto="extra")}function fecharPopUp(){isPainelAjudaAberto&&(document.querySelector(".modal-ajuda").style.display="none","consulta"==guiaAberto?document.getElementById("AjudaConsulta").style.display="none":"cadastro"==guiaAberto?document.getElementById("AjudaCadastro").style.display="none":"alteracao"==guiaAberto?document.getElementById("AjudaAlteracao").style.display="none":"adicaoImagem"==guiaAberto?document.getElementById("AjudaAdicaoImagem").style.display="none":"remocaoImagem"==guiaAberto?document.getElementById("AjudaRemocaoImagem").style.display="none":"extra"==guiaAberto&&(document.getElementById("AjudaExtra").style.display="none"),isPainelAjudaAberto=!1,guiaAberto="nenhum"),"/cadastro-ordem.html"==pagina&&(document.getElementById("PopUpCadastro").style.display="none",document.getElementById("PopUpErroCadastroExiste").style.display="none",document.getElementById("PopUpErroBuscaIntervalo").style.display="none"),"/index.html"!=pagina&&"/resultados-busca.html"!=pagina||(document.getElementById("PopUpErroBusca").style.display="none",document.getElementById("PopUpErroBuscaIntervalo").style.display="none"),"/ordem.html"==pagina&&(document.getElementById("PopUpExclusao").style.display="none",document.getElementById("PopUpObservacaoVazia").style.display="none",document.getElementById("PopUpErroFormatoImagem").style.display="none",document.getElementById("PopUpObservacaoPreenchida").style.display="none",document.getElementById("PopUpEdicaoObservacao").style.display="none",document.getElementById("PopUpConfirmacaoAlteracao").style.display="none",document.getElementById("PopUpExclusaoImagem").style.display="none",document.getElementById("PopUpImagem").style.display="none",document.getElementById("PopUpErroEdicaoObservacao").style.display="none")}function AbrirPopUpCadastro(){document.getElementById("PopUpCadastro").style.display="flex"}function AbrirPopUpEdicaoObservacao(){var e=localStorage.getItem("observacao");document.getElementById("PopUpObservacaoPreenchida").style.display="none",document.getElementById("PopUpEdicaoObservacao").style.display="flex",document.querySelector(".observacao-preenchida").value=e}